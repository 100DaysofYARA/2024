import "pe"
rule CRIME_VALLEYFALL_PDB_PATH_IMPHASH_MALWARE{
	meta:
		version = "1"
		date = "1/24/24"
		modified = "1/24/24"
		status = "RELEASED"
		sharing = "TLP:CLEAR"
		source = "n/a"
		author = "@x0rc1sm"
		description = "Unique PDB Path or import hash for malware family "
		category = "malware"
		malware_type = "BACKDOOR"
		malware_family = "VALLEYFALL"
		mitre_att = "TA0002, TA0003, TA0004, TA0005, TA0006, TA0007, TA0009"
		actor_type = "CRIME"
		actor = "UNK"
		report = "https://www.avira.com/en/blog/valleyfall-spyware-in-the-wild-from-one-sample-to-a-hive-of-malware-servers"
		hash = "39970f254b9b88a8879ce5322c6112a9"
		hash = "d34dfaebb5e03dac50b2feef8a4704b2073e52c1"
		hash = "d9d6bde1ade8ae154331b7f7e50564ad17bf9368728959a0a74764ae60bec618"
	strings:
		$PDB1 = {43 3A 5C 55 73 65 72 73 5C E8 B0 B7 E5 A0 95 5C 44 65 73 6B 74 6F 70 5C 32 30 32 32 E8 BF 9C E7 A8 8B E7 AE A1 E7 90 86 67 66 69 5C 63 61 6E 67 6B 75 5C 57 69 6E 4F 73 43 6C 69 65 6E 74 50 72 6F 6A 65 63 74 5C 52 65 6C 65 61 73 65 2D 65 78 65 5C E4 B8 8A E7 BA BF E6 A8 A1 E5 9D 97 2E 70 64 62} //C:\Users\谷堕\Desktop\2022远程管理gfi\cangku\WinOsClientProject\Release-exe\上线模块.pdb 
		$PDB2 = {43 3A 5C 55 73 65 72 73 5C E8 B0 B7 E5 A0 95 5C 44 65 73 6B 74 6F 70 5C 32 30 32 32 E8 BF 9C E7 A8 8B E7 AE A1 E7 90 86 67 66 69 5C 63 61 6E 67 6B 75 5C 57 69 6E 4F 73 43 6C 69 65 6E 74 50 72 6F 6A 65 63 74} //C:\Users\谷堕\Desktop\2022远程管理gfi\cangku\WinOsClientProject\
		$PDB3 = {5C E4 B8 8A E7 BA BF E6 A8 A1 E5 9D 97 2E 70 64 62} //上线模块.pdb
	condition:
		uint16(0) == 0x5a4d and (any of ($PDB*) or pe.imphash() == "9d7ac77a44667ba5186f7bb12dfd9d42")
}
